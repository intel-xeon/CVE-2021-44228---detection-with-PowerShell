$ResultsCSV = "C:\Users\l.marsilia\Documents\Log4j super\test\VEROs.csv" #save the result #MANDATORY FIELD
if (Test-Path $ResultsCSV) 
{
  Remove-Item -Path $ResultsCSV -Force
}
$Directory = "C:\Users\l.marsilia\Documents\Log4j super\test" #directory to scan for logs file #MANDATORY FIELD
$RX = "\bjndi:ldap:|\bjndi:rmi:|\bjndi:ldaps:|\bjndi:dns:|\bjndi:nis:|\bjndi:nds:|\bjndi:corba:|\bjndi:iiop:|\bjndi:http:]"
$TextFiles = Get-ChildItem $Directory -Include *.txt*,*.csv*,*.rtf*,*.eml*,*.msg*,*.dat*,*.ini*,*.mht* -Recurse
$file2 =  new-object System.IO.StreamWriter($ResultsCSV)
$file2.WriteLine('Matches,File Path') 
foreach ($FileSearched in $TextFiles) {
#echo $FileSearched
$file = New-Object System.IO.StreamReader ($FileSearched)
foreach($line in Get-Content $FileSearched) {
	#echo $line
    foreach ($match in ([regex]$RX).Matches($line)) {   
		$file2.WriteLine("{0},{1}",$line, $FileSearched.fullname )  
	}
}

$file.close();  
}
$file2.close()
